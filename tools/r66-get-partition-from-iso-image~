#! /bin/bash

PARTITION_IMAGE=sdd1.img
DISK_IMAGE=sdd.img
PARTITION_NUMBER=1

BLOCK_SIZE=512

SDD1_START=2048
SDD2_START=1026048
SDD3_START=2050048

SDD_SIZE=4098048
SDD1_SIZE=1024000
SDD2_SIZE=1024000
SDD3_SIZE=2048000

SDD1_OFFSET=`expr $SDD1_START \* $BLOCK_SIZE`
SDD2_OFFSET=`expr $SDD2_START \* $BLOCK_SIZE`
SDD3_OFFSET=`expr $SDD3_START \* $BLOCK_SIZE`
# >>> 2048 * 512
# 1048576
# >>> 1026048 * 512
# 525336576
# >>> 2050048 * 512
# 1049624576

if [ $# -eq 3 ] 
then
  DISK_IMAGE=$1
  PARTITION_IMAGE=$3
  PARTITION_NUMBER=$2
else
  echo "Usage: $0 $DISK_IMAGE $PARTITION_NUMBER $PARTITION_IMAGE"
  echo "    disk image path: $DISK_IMAGE"
  echo "    partition number: $PARTITION_NUMBER"
  echo "    resulting partition image path: $PARTITION_IMAGE"
  exit -1
fi

START=$SDD1_START
if [ $PARTITION_NUMBER -eq 1 ] 
then
  START=$SDD1_START
  SIZE=$SDD1_SIZE
fi

if [ $PARTITION_NUMBER -eq 2 ] 
then
  START=$SDD2_START
  SIZE=$SDD2_SIZE
fi

if [ $PARTITION_NUMBER -eq 3 ] 
then
  START=$SDD3_START
  SIZE=$SDD3_SIZE
fi


echo dd if=$DISK_IMAGE of=$PARTITION_IMAGE skip=$START count=$SIZE


